# 이동수단 분류 모델 개발 중간 보고서

**프로젝트 목표:** GeoLife GPS 궤적 데이터 기반 사용자 이동 상태 분류 모델 개발. 핵심 목표는 '인간 동력 기반 활동(걷기, 자전거)'과 '그 외 동력 이동수단'을 명확히 구분하는 것임.


## 1차 모델링: 11개 전체 클래스 분류

### 1.1. 학습 데이터 분포 및 문제점

* **데이터 현황:** 원본 데이터셋의 11개 라벨을 모두 사용함. 아래는 학습에 사용된 전체 원본 데이터의 분포임.
    ```
    +----------+-----+
    |label     |count|
    +----------+-----+
    |bus       |2853 |
    |boat      |7    |
    |walk      |6460 |
    |run       |6    |
    |car       |993  |
    |bike      |2089 |
    |motorcycle|2    |
    |train     |299  |
    |taxi      |1179 |
    |subway    |813  |
    |airplane  |17   |
    +----------+-----+
    ```
* **핵심 문제:** `run`(6), `boat`(7), `motorcycle`(2) 등 다수 클래스의 데이터가 극심하게 부족하여, 모델이 유의미한 패턴을 학습하기 어려운 **심각한 데이터 불균형 상태** 확인.

### 1.2. 1차 모델 성능

* **정확도 (Accuracy): 0.4688 (47%)**
* **F1 점수 (F1 Score): 0.4108 (41%)**

### 1.3. 분석 및 진단

* **성능 평가:** 무작위 예측(약 9%)보다는 높으나, 모델의 전반적인 성능은 낮음.
* **혼동 행렬 분석:** 모델이 대부분의 이동수단을 **`walk`로 잘못 예측하는 매우 심각한 편향**을 보임.

| 실제 \ 예측 | walk | bus | car | bike | train | **정답 (TP)** | **총계** | **정답률 (Recall)** | 진단 |
| :--- | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :--- |
| **walk** | **25169** | 1150 | 237 | 353 | 59 | **25169** | 26968 | **93.3%** | **분류 성공적** |
| **bus** | **11456** | 6405 | 2544 | 746 | 356 | **6405** | 21507 | 29.8% | walk로 심각하게 오분류 |
| **car** | **4380** | 2822 | 5461 | 957 | 1045 | **5461** | 14665 | 37.2% | walk로 심각하게 오분류 |
| **bike** | **9110** | 945 | 498 | 2098 | 19 | **2098** | 12670 | 16.5% | walk로 심각하게 오분류 |
| **train** | 854 | 566 | 1800 | 505 | **4118** | **4118** | 7843 | 52.5% | 비교적 양호 |

* **앞으로의 과제:**
    1.  **예측 편향:** `walk` 데이터가 가장 많다 보니, 모델이 불확실할 때 대부분 `walk`로 예측하는 손쉬운 길을 택함. 이로 인해 다른 클래스들의 성능이 급격히 저하됨.
    2.  **데이터 불균형:** 소수 클래스는 학습 자체가 되지 않음.
    3.  **유사 클래스 간 모호성:** `bus`, `car` 등 차량 이동수단 간 특징 구분에 실패함.

### 1.4. 다음 목표 설정

* `walk`로의 예측 편향과 클래스 간 모호성 문제를 해결하기 위해 **'문제 단순화'** 전략 수립.
* 핵심 목표인 '걷기', '자전거' 분류에 집중하기 위해 라벨을 3개 핵심 카테고리로 재그룹화하기로 결정함.


## 2차 모델링: 3개 핵심 클래스 재분류

### 2.1. 2차 모델링 전략

* **데이터 정제:** `airplane`, `boat` 등 이질적 데이터 제외.
* **라벨 재그룹화:** 유사 클래스를 통합하여 `walk`, `bike`, `transport` 3개 그룹으로 재구성함.
    * **`walk` 그룹:** 'walk', 'run' 통합
    * **`bike` 그룹:** 'bike', 'motorcycle' 통합
    * **`transport` 그룹:** 'bus', 'car', 'taxi', 'subway', 'train' 통합
* **최종 학습 데이터 분포:**
    ```
    +---------+-----+
    |label    |count|
    +---------+-----+
    |transport|6137 |
    |walk     |6466 |
    |bike     |2091 |
    +---------+-----+
    ```

### 2.2. 2차 모델 성능

* **정확도 (Accuracy): 0.6308 (63%)**
* **F1 점수 (F1 Score): 0.5927 (59%)**

### 2.3. 분석 및 진단

* **성능 향상 유의미성:** 
    * 1차 대비 **정확도 16.2%p, F1 점수 18.2%p 상승.** 
    * 문제 단순화 전략이 통계적으로 매우 유의미한 성능 향상을 가져옴.
* **혼동 행렬 분석:** `walk` 분류 성능이 80.9%로 매우 높아졌으며, `transport` 분류도 69.1%로 준수한 성능을 보임.

| 실제 \ 예측 | transport | walk | bike | **정답 (TP)** | **총계** | **정답률 (Recall)** | 진단 |
| :--- | :---: | :---: | :---: | :---: | :---: | :---: | :--- |
| **transport**| **35828**| 15959 | 18 | **35828**| 51805 | 69.1% | **비교적 양호** |
| **walk** | 5182 | **21934**| 1 | **21934**| 27117 | 80.9% | **분류 성공적** |
| **bike** | 5843 | 6861 | **98** | **98** | 12802 | **0.8%** | **분류 완전 실패** |

* **앞으로의 과제:** 
    * **`bike` 분류 성능이 0.8%로 처참한 수준.** 
    * 모델은 `bike`를 `walk`나 `transport`와 전혀 구분하지 못하고 있음. 
    * 이는 프로젝트의 핵심 목표 달성에 있어 가장 큰 장애물임.

### 2.4. 다음 목표 설정
* `bike`와 다른 클래스를 구분할 수 있는 새로운 특징(예: 정차 빈도, 방향 전환율, 가속도 변화율 등)을 개발하여 모델에 제공해야 함.
* `bike` 데이터가 상대적으로 적으므로, 학습 시 클래스 가중치 부여 또는 오버샘플링 기법을 적용하여 모델이 `bike`의 중요도를 높게 인식하도록 유도해야 함.

## 3차 모델링: 피처 엔지니어링 및 클래스 가중치 적용

### 3.1. 3차 모델링 전략

2차 모델의 '자전거 분류 실패' 문제를 해결하기 위해 다음 두 가지 핵심 전략을 적용함.

1.  **자전거 맞춤 피처 엔지니어링:** 움직임의 급격한 변화를 측정하는 '저크(Jerk)'와 '방향 전환율 변동성' 등 새로운 특징을 추가하여 `bike`와 다른 클래스 간의 차이를 부각시킴.
2.  **데이터 불균형 해소:** 학습 시 데이터 수가 적은 `bike` 클래스의 오류에 더 큰 페널티를 부여하는 **클래스 가중치(Class Weights)** 를 적용하여 모델이 `bike`를 더 중요하게 학습하도록 유도함.

### 3.2. 3차 모델 성능

* **정확도 (Accuracy): 0.5937 (59.4%)**
* **F1 점수 (F1 Score): 0.6163 (61.6%)**

### 3.3. 분석 및 진단

* **성능 변화 분석:** 
    * 2차 모델 대비 전체 정확도는 약 3.7%p 하락했으나, **F1 점수는 2.3%p 상승**함. 
    * 이는 소수 클래스(`bike`) 예측 성능이 대폭 개선되면서 전체적인 예측 균형이 좋아졌음을 의미하는 긍정적인 신호로 보임.
* **혼동 행렬 분석:**
    * 가장 큰 문제였던 **`bike`의 정답률(Recall)이 0.8%에서 66.6%로 극적으로 향상**됨. 
    * 이제 모델은 자전거를 유의미하게 분류할 수 있게 됨.
    * `bike` 분류 성능을 높이는 과정에서, 모델이 일부 `transport`와 `walk`를 `bike`로 오분류하는 경향이 생겨 해당 클래스들의 정답률이 소폭 하락하는 트레이드오프가 발생함.

| 실제 \ 예측 | transport | walk | bike | **정답 (TP)** | **총계** | **정답률 (Recall)** | 진단 |
| :--- | :---: | :---: | :---: | :---: | :---: | :---: | :--- |
| **transport**| **27022** | 13479 | 11304 | **27022** | 51805 | 52.2% | 성능 다소 하락 |
| **walk** | 959 | **18912** | 7246 | **18912** | 27117 | 69.8% | 성능 다소 하락 |
| **bike** | 618 | 3660 | **8524** | **8524** | 12802 | **66.6%** | **성능 극적 향상** |

* **앞으로의 과제:** 
    * `bike` 분류 능력을 확보했지만, 그 대가로 다른 클래스와의 혼동이 일부 증가하여 전체 정확도가 소폭 하락함.

### 3.4. 다음 목표 설정
* 이제 문제는 "분류 불가"에서 **"정밀도 개선"** 으로 전환됨. 다음 단계는 세 클래스 간의 분류 균형을 맞추고 전반적인 성능을 끌어올리는 데 집중해야 함.
1.  **하이퍼파라미터 튜닝:** 현재 사용 중인 RandomForestClassifier의 `numTrees`, `maxDepth` 등 주요 파라미터를 체계적으로 조정하여, 세 클래스 간의 최적의 분류 경계선을 찾는 작업을 진행해야 함.
2.  **고급 모델 적용:** 현재 모델보다 복잡한 패턴 학습에 유리한 그래디언트 부스팅(Gradient Boosting) 계열의 모델(예: XGBoost, LightGBM)을 도입하여 성능을 한 단계 더 끌어올리는 것을 고려할 수 있음.

## 4차 모델링: 하이퍼파라미터 튜닝

### 4.1. 4차 모델링 전략

3차 모델에서 발생한 트레이드오프를 해결하고 전체적인 예측 균형을 맞추기 위해, RandomForestClassifier의 주요 하이퍼파라미터에 대한 최적화를 진행함.

**최적 하이퍼파라미터:**
* numTrees: 150
* maxDepth: 15

### 4.2. 4차 모델 성능

* **정확도 (Accuracy): 0.6559 (65.6%)**
* **F1 점수 (F1 Score): 0.6693 (66.9%)**

### 4.3. 분석 및 진단

* **성능 변화 분석:**
    * 3차 모델 대비 **정확도는 6.2%p, F1 점수는 5.3%p 동반 상승**함.
    * 하이퍼파라미터 튜닝을 통해 각 클래스 간 분류 경계가 더 정교하게 설정되었고, `bike` 분류 성능을 일정 수준 유지하면서 다른 클래스의 성능을 회복시켜 예측 균형이 크게 개선되었음을 의미함.

* **혼동 행렬 분석:**
    * `walk`의 정답률이 77.3%로 가장 안정적인 성능을 보임.
    * `bike`의 정답률은 65.1%로 3차 모델(66.6%)과 거의 유사한 수준을 유지하면서, `transport`의 정답률을 52.2%에서 59.6%로 회복시킴.
    * 이는 `bike` 분류 성능을 희생하지 않으면서도 다른 클래스와의 오분류를 줄여, 모델 전반의 균형을 성공적으로 개선했음을 보여줌.

| 실제 \ 예측 | transport | walk  | bike | **정답 (TP)** | **총계** | **정답률 (Recall)** | 진단           |
| :---------- | :-------: | :---: | :--: | :-----------: | :------: | :-----------------: | :------------- |
| **transport** | **30861** | 13957 | 6987 |   **30861** |  51805   |       59.6%       | 성능 회복      |
| **walk** |   1631    | 20967 | 4519 |   **20967** |  27117   |       77.3%       | **안정적 성능** |
| **bike** |    916    | 3550  | 8336 |   **8336** |  12802   |       65.1%       | **성능 유지** |
 
## 5차 모델링: 추가 피처 엔지니어링 및 재튜닝

### 5.1. 5차 모델링 전략

4차 모델링을 통해 예측의 균형은 개선되었으나, 여전히 클래스 간 혼동이 남아있는 문제를 해결하기 위해 **움직임의 미세한 특징을 포착**할 수 있는 추가 피처 엔지니어링을 진행하고, 이에 맞춰 하이퍼파라미터를 다시 최적화함.

* **추가된 주요 피처:**

| 피처명                  | 설명                                                                                                                           |
| :---------------------- | :----------------------------------------------------------------------------------------------------------------------------- |
| `avg_jerk`, `max_jerk`  | 평균/최대 저크(가속도 변화율). 움직임의 급격한 변화를 측정하여 `bike` 분류 성능 개선.                                             |
| `stddev_jerk`           | 저크(가속도 변화율)의 표준편차. `bike`와 같이 페달링, 제동 등으로 인해 움직임의 변화가 잦고 불규칙한 경우 값이 높게 나타남.         |
| `stddev_bearing_rate`   | 방위각 변화율의 표준편차. 방향 전환의 변동성을 측정하여 `bike`와 다른 활동 구분 강화.                                             |

* **최적 하이퍼파라미터 재조정:**

    * numTrees: 100
    * maxDepth: 15

### 5.2. 5차 모델 성능

* **정확도 (Accuracy): 0.6638 (66.4%)**
* **F1 점수 (F1 Score): 0.6768 (67.7%)**

### 5.3. 분석 및 진단

* **성능 변화 분석:**
    * 4차 모델 대비 **정확도는 0.8%p, F1 점수는 0.8%p 추가 상승**함.
    * `jerk`와 `bearing_rate` 관련 피처가 `bike`와 다른 이동수단 간의 미세한 차이를 구분하는 데 긍정적인 역할을 하여, 전반적인 성능 개선을 이끌어 냄.

* **혼동 행렬 분석:**
    * 가장 주목할 점은 **모든 클래스의 정답률(Recall)이 골고루 상승**했다는 것.
    * `walk`의 정답률이 78.1%로 가장 높은 성능을 보였고, `bike`는 66.0%, `transport`는 60.4%로 개선됨.
    * 이는 특정 클래스에 대한 성능 희생 없이, 새롭게 추가된 피처들이 모든 클래스 간의 분류 경계를 명확하게 하는 데 기여했음을 의미함. 4차 모델링까지 남아있던 클래스 간 혼동 문제를 일부 해소하며, 모델의 완성도를 한 단계 높임.

| 실제 \ 예측 | transport | walk  | bike | **정답 (TP)** | **총계** | **정답률 (Recall)** | 진단             |
| :---------- | :-------: | :---: | :--: | :-----------: | :------: | :-----------------: | :--------------- |
| **transport** | **31392** | 13929 | 6644 |   **31392** |  51965   |        60.4%        | **성능 소폭 개선** |
| **walk** |   1544    | 21085 | 4372 |   **21085** |  27001   |        78.1%        | **최고 성능** |
| **bike** |    977    | 3374  | 8434 |   **8434** |  12785   |        66.0%        | **성능 소폭 개선** |

## 6. 현재까지의 종합 결론 및 향후 방향

* **현재까지의 성과:**
    * 복잡한 11개 클래스 분류 문제를 3개 핵심 클래스로 단순화하여 전체적인 성능의 기반을 다짐.
    * 피처 엔지니어링과 클래스 가중치 적용을 통해, **모델이 '자전거'를 전혀 인식하지 못하던 치명적인 문제를 성공적으로 해결**함.
    * 하이퍼파라미터 튜닝과 추가 피처 엔지니어링을 통해 `bike` 분류 성능을 유지하면서 다른 클래스와의 예측 균형을 맞추어, **전체 클래스에 대한 유의미한 분류 능력을 확보**함.

* **현재의 한계:**
    * **여전한 클래스 간 혼동:** `transport` 데이터의 약 26%가 `walk`로, `walk` 데이터의 약 16%가 `bike`로 오분류되는 등 클래스 간 혼동이 여전히 존재함. 이는 속도가 느린 차량(버스 정체)과 빠른 걸음, 혹은 언덕을 오르는 자전거와 걷기 등 유사한 속도 패턴을 보이는 구간에서 발생하는 문제로 추정됨.
    * **전체 성능의 한계:** 최종 정확도(66.4%)와 F1 점수(67.7%)는 초기 모델에 비해 크게 향상되었으나, 실제 서비스에 적용하기에는 아직 부족한 수준임.

* **향후 방향:**
    1.  **고급 모델(XGBoost/LightGBM) 도입:** RandomForest보다 복잡한 패턴 학습 및 성능 개선에 유리한 그래디언트 부스팅 계열 모델을 적용하여 현재의 성능 한계를 돌파하는 시도가 필요함.
    2.  **추가 피처 엔지니어링:**
        * **시간대별 특징:** 출퇴근 시간 등 특정 시간대에 따른 이동 패턴을 피처로 추가.
        * **궤적의 안정성:** GPS 궤적의 변동성을 나타내는 피처를 추가하여, 정류장에 자주 서는 버스와 비교적 일정하게 움직이는 자전거/걷기를 구분.
    3.  **후처리(Post-processing) 기법 적용:** 단일 예측이 아닌, 시계열의 맥락을 고려하여 예측 결과를 보정. 예를 들어, 긴 `walk` 궤적 중간에 `transport`가 한두 번 예측될 경우, 이를 오류로 간주하고 `walk`로 보정하는 규칙 기반 스무딩(smoothing)을 적용.

## 7. 프로젝트 최종 결론

본 모델 개발은 초기 목표였던 'RandomForest 알고리즘 적용 및 평가' 측면에서 의미 있는 결과를 도출함. 무작위 예측(33%) 대비 2배 이상 향상된 현재 성능은 초기 목표 달성에 충분한 수준으로 평가됨. 특히 '자전거'는 인간 동력과 기계 동력의 경계에 있어 분류 난이도가 높았음을 감안할 때, 현재의 분류 성능은 결코 실망스럽지 않은 결과임.

하지만 GeoLife 데이터셋만으로는 실제 도로 환경이나 사용자의 다양한 이동 패턴을 반영하는 추가적인 특징(Feature)을 추론하고 생성하는 데 명백한 한계가 존재함. 따라서 현재 단계에서 피처 엔지니어링과 모델링을 통한 추가적인 성능 향상은 종료하는 것이 합리적이라 판단됨.

향후 모델의 정확도 개선은 다음과 같은 실용적인 접근으로 전환.
1.  **후처리(Post-processing) 강화:** 예측된 타임라인에서 비정상적인 상태 변화(예: walk → transport → walk가 1분 내에 발생)를 감지 및 보정하는 로직을 구현하여 예측 결과의 안정성 확보.
2.  **사용자 피드백 기반의 파인 튜닝:** 사용자가 운동 보고서에서 잘못 분류된 구간을 수정하면, 해당 (원본 GPS 데이터, 수정된 라벨)을 별도 데이터베이스에 축적. 이 데이터를 향후 모델 재학습이나 미세 조정(Fine-tuning)의 중요한 자산으로 활용.

끝.
